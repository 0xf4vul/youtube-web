(this["webpackJsonpreate-ts"]=this["webpackJsonpreate-ts"]||[]).push([[0],{145:function(e,t,a){},230:function(e,t,a){e.exports=a(414)},390:function(e,t){},414:function(e,t,a){"use strict";a.r(t);var n=a(0),o=a.n(n),i=a(18),r=a.n(i),l=(a(235),a(79)),s=a(63),c=a(64),d=a(69),u=a(68),m=a(39),p=(a(145),a(197)),h=a(419),f=a(423),g=a(56),v=a(78),y=a.n(v),k=a(196),b=a.n(k);function E(e,t){return new Promise((function(a,n){y.a.get(e,{params:t}).then((function(e){a(e.data)})).catch((function(e){n(e.data)}))}))}function S(e,t){return new Promise((function(a,n){y.a.post(e,b.a.stringify(t)).then((function(e){a(e.data)})).catch((function(e){n(e.data)}))}))}y.a.defaults.baseURL="/api",y.a.defaults.timeout=1e4,y.a.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded;charset=UTF-8",y.a.interceptors.request.use((function(e){return e}),(function(e){return Promise.reject(e)})),y.a.interceptors.response.use((function(e){return 200===e.status?Promise.resolve(e):Promise.reject(e)}),(function(e){if(e.response.status)return Promise.reject(e.response)}));var _=function(e){Object(d.a)(a,e);var t=Object(u.a)(a);function a(){var e;Object(s.a)(this,a);for(var n=arguments.length,o=new Array(n),i=0;i<n;i++)o[i]=arguments[i];return(e=t.call.apply(t,[this].concat(o))).state={token:""},e.onFinish=function(t){S("/token",{username:t.username}).then((function(t){if(t.status){var a=t.data.token;localStorage.setItem("token",a),localStorage.setItem("isManager",t.data.isManager),e.setState({token:a})}else p.a.error("\u9519\u8bef\u7684\u7528\u6237\u540d")})).catch((function(e){console.log(e)}))},e}return Object(c.a)(a,[{key:"componentDidMount",value:function(){var e=localStorage.getItem("token")||"";this.setState({token:e})}},{key:"render",value:function(){if(this.state.token)return o.a.createElement(m.a,{to:"/Video"});var e={wrapperCol:{offset:8,span:16}};return o.a.createElement("div",{className:"login-page"},o.a.createElement(h.a,Object.assign({},{labelCol:{span:8},wrapperCol:{span:16}},{name:"basic",initialValues:{remember:!0},onFinish:this.onFinish}),o.a.createElement(h.a.Item,{label:"\u60a8\u662f\uff1f",name:"username",rules:[{required:!0,message:"\u8f93\u5165\u767b\u5f55\u7528\u6237\u540d"}]},o.a.createElement(f.a,null)),o.a.createElement(h.a.Item,e,o.a.createElement(g.a,{type:"primary",htmlType:"submit"},"\u597d\u7684"))))}}]),a}(n.Component),C=a(159),w=a.n(C),O=a(203),I=a(417),j=a(425),N=a(418),T=a(422),P=a(426),V=a(208),x=a(96),D=a(61),M=a(225),L=a(424),A=a(420),B=a(427),F=a(428),J=function(e){Object(d.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(s.a)(this,a),(n=t.call(this,e)).state={token:"",drawer_visible:!1,video_list:[],videos:[],current_list_id:"",page:{current:1,total:1,count:1},page_title:"",sort:1,channelVisible:!1,addChannel:!1,addChannelId:""},n.video_dom=[],n.getVideoList=function(){return E("/video_list",{token:localStorage.getItem("token")||""}).then((function(e){return e.status&&e.data.length?e.data:[]}))},n.getVideos=function(e,t,a){var o=localStorage.getItem("token")||"",i=n.state,r=i.current_list_id,l=i.page,s=i.sort;e&&(r=e);var c=l.current;return t&&(c=t),void 0!==a&&(s=a),E("/videos",{token:o,id:r,page:c,sort:s}).then((function(e){return e.status&&e.data.list.length?e.data:[]}))},n.showDrawer=function(){n.setState({drawer_visible:!0})},n.onClose=function(){n.setState({drawer_visible:!1})},n.handleListChange=function(e,t){n.getVideos(e,1,1).then((function(a){n.setState({drawer_visible:!1,videos:a.list,page:a.page,current_list_id:e,page_title:t});var o=localStorage.getItem("video_id");if(o){var i=n.video_dom.findIndex((function(e){return e.id===o}));-1!==i?window.scrollTo(0,n.video_dom[i].srcoll-74):window.scrollTo(0,0)}n.storageScrollTop(),n.handleScroll("event")}))},n.onPageChange=function(e){n.getVideos("",e).then((function(e){n.setState({videos:e.list,page:e.page}),n.storageScrollTop()}))},n.onSortChange=function(){var e=n.state.sort;e=1===e?0:1,n.getVideos("",1,e).then((function(t){n.setState({videos:t.list,page:t.page,sort:e}),n.storageScrollTop()}))},n.storageScrollTop=function(){var e=n.state,t=e.current_list_id,a=e.page,o=e.sort;localStorage.setItem("page_info",JSON.stringify({id:t,page:a.current,sort:o}))},n.storageVideoId=function(e){localStorage.setItem("video_id",e)},n.handleScroll=function(e){for(var t=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop,a=localStorage.getItem("video_id"),o=0;o<n.video_dom.length;o++)if(n.video_dom[o].srcoll>t){n.video_dom[o].id!=a&&n.storageVideoId(n.video_dom[o].id);break}},n.isPlay=function(e){var t=localStorage.getItem("played"),a=[];return t&&(a=JSON.parse(t)),-1!==a.indexOf(e)},n.logout=function(){localStorage.removeItem("token"),n.setState({token:""}),window.location.reload()},n.handlePlayClick=function(e,t,a){var o,i=localStorage.getItem("played");i?(o=JSON.parse(i)).push(e):o=[e],localStorage.setItem("played",JSON.stringify(o)),n.props.history.push({pathname:"/Play",state:{id:e,type:t,title:a}})},n.handleAddChange=function(){n.setState({channelVisible:!0})},n.handleAddChannelOk=function(){var e=n.state.addChannelId,t=localStorage.getItem("token")||"";if(34!=e.length)return p.a.error("\u9519\u8bef\u7684ID"),!1;S("/admin/video_list",{id:e,token:t}).then((function(e){e.status?p.a.success("\u6dfb\u52a0\u6210\u529f"):p.a.warning(e.msg)})),n.setState({channelVisible:!1})},n.handleAddChannelCancel=function(){n.setState({channelVisible:!1})},n.listUpdate=function(){S("/list_update",{id:n.state.current_list_id,token:localStorage.getItem("token")}).then((function(e){e.status?p.a.loading("\u89c6\u9891\u5217\u8868\u66f4\u65b0\u6210\u529f",2.5,(function(){window.location.reload()})):p.a.warn("\u66f4\u65b0\u5931\u8d25")}))},n}return Object(c.a)(a,[{key:"componentDidMount",value:function(){var e=Object(O.a)(w.a.mark((function e(){var t,a,n,o=this;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(window.addEventListener("scroll",this.handleScroll),t=localStorage.getItem("token")||"",a=localStorage.getItem("isManager")||"0",n="1"==a,!t){e.next=7;break}return e.next=7,this.getVideoList().then((function(e){if(e.length){var t=e,a="",i=1,r=1,l=localStorage.getItem("page_info")||"";if(l){var s=JSON.parse(l);a=s.id,i=s.page,r=s.sort}var c=t[0].title;if(a){var d=t.find((function(e){return e.id===a}));d&&d.title&&(c=d.title)}else a=t[0].id;o.getVideos(a,i,r).then((function(e){o.setState({video_list:t,videos:e.list,page:e.page,current_list_id:a,page_title:c,addChannel:n});var i=localStorage.getItem("video_id");if(i){var r=o.video_dom.findIndex((function(e){return e.id===i}));-1!==r&&window.scrollTo(0,o.video_dom[r].srcoll-74)}o.storageScrollTop(),o.handleScroll("event")}))}}));case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"componentDidUpdate",value:function(){for(var e=document.getElementsByClassName("video_card"),t=[],a=0;a<e.length;a++)t.push({id:e[a].id,srcoll:this.getOffsetTop(e[a])});this.video_dom=t,window.scrollTo(0,0)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("scroll",this.handleScroll)}},{key:"getOffsetTop",value:function(e){for(var t=0;e!=window.document.body&&null!=e;)t+=e.offsetTop,e=e.offsetParent;return t}},{key:"render",value:function(){var e=this,t=localStorage.getItem("token")||"",a=this.state,n=a.videos,i=a.drawer_visible,r=a.video_list,l=a.page_title,s=a.sort,c=a.addChannel,d=a.current_list_id,u=I.a.Meta;if(t){var p=[o.a.createElement(g.a,{onClick:this.logout},"\u9000\u51fa"),o.a.createElement(g.a,{onClick:this.onSortChange},s?"\u6700\u65b0":"\u6700\u65e9"),o.a.createElement(g.a,{type:"primary",shape:"circle",icon:o.a.createElement(B.a,null),onClick:this.listUpdate})];return c&&p.push(o.a.createElement(g.a,{shape:"circle",onClick:this.handleAddChange},"+")),o.a.createElement(o.a.Fragment,null,o.a.createElement(j.a,{offsetTop:0},o.a.createElement(N.a,{className:"site-page-header",onBack:this.showDrawer,title:l,subTitle:"",ghost:!1,backIcon:o.a.createElement(F.a,null),extra:p})),o.a.createElement(T.a,{title:"\u64ad\u653e\u5217\u8868",placement:"left",closable:!1,onClose:this.onClose,visible:i},o.a.createElement(P.b,{itemLayout:"horizontal",dataSource:r,renderItem:function(t){return o.a.createElement(P.b.Item,null,o.a.createElement(P.b.Item.Meta,{avatar:o.a.createElement(V.a,{src:t.thumbnail}),title:o.a.createElement(g.a,{type:t.id==d?"link":"text",onClick:function(){return e.handleListChange(t.id,t.title)}},t.title)}))}})),o.a.createElement(x.a,{className:"card_list",gutter:{md:16,xl:32}},n.map((function(t,a){return o.a.createElement(D.a,{sm:32,md:16,xl:8,className:"video_card card_margin_bottom",id:"video_"+t.id,key:a},o.a.createElement(I.a,{style:{width:"100%"},cover:o.a.createElement("img",{alt:"example",src:t.thumbnail}),actions:[o.a.createElement(g.a,{onClick:function(){e.handlePlayClick(t.id,"video",t.title)},type:e.isPlay(t.id)?"dashed":"primary"},"\u89c6\u9891"),o.a.createElement(g.a,{onClick:function(){e.handlePlayClick(t.id,"audio",t.title)},type:e.isPlay(t.id)?"dashed":"default"},"\u97f3\u9891")]},o.a.createElement(u,{title:t.title,description:t.created_at})))}))),o.a.createElement(M.a,{current:this.state.page.current,onChange:this.onPageChange,defaultPageSize:50,total:this.state.page.total,showSizeChanger:!1}),o.a.createElement(L.a,null),o.a.createElement(A.a,{title:"\u6dfb\u52a0\u9891\u9053",visible:this.state.channelVisible,onOk:this.handleAddChannelOk,onCancel:this.handleAddChannelCancel},o.a.createElement(f.a,{placeholder:"\u8f93\u5165\u5217\u8868ID",onChange:function(t){e.setState({addChannelId:t.target.value})}})))}return o.a.createElement(m.a,{to:"/"})}}]),a}(n.Component),U=Object(m.g)(J),z=a(227),q=(a(406),function(e){Object(d.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(s.a)(this,a),(n=t.call(this,e)).player=void 0,n.videoNode=void 0,n.player=void 0,n.videoNode=void 0,n}return Object(c.a)(a,[{key:"componentDidMount",value:function(){this.player=Object(z.a)(this.videoNode,this.props).ready((function(){}))}},{key:"componentWillUnmount",value:function(){this.player&&this.player.dispose()}},{key:"render",value:function(){var e=this;return n.createElement("div",{className:"c-player"},n.createElement("div",{className:"c-player__screen","data-vjs-player":"true"},n.createElement("video",{ref:function(t){return e.videoNode=t},className:"video-js vjs-16-9"})))}}]),a}(n.Component)),W=a(421),R=a(416),Y=a(212),G=function(e){Object(d.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(s.a)(this,a),(n=t.call(this,e)).state={token:"",id:"",type:"",title:"",videoOptions:{}},n.player=void 0,n}return Object(c.a)(a,[{key:"componentDidMount",value:function(){var e,t=localStorage.getItem("token")||"";if(null===(e=this.props.location.state)||void 0===e?void 0:e.id){var a=this.props.location.state,n=a.id,o=a.type,i=a.title,r="video/mp4";"audio"==o&&(r="audio/mp4"),this.setState({token:t,id:n,type:o,title:i,videoOptions:{autoplay:!0,controls:!0,sources:{src:"/api/play?id=".concat(n,"&type=").concat(o,"&token=").concat(t),type:r}}})}else this.props.history.push("/")}},{key:"render",value:function(){var e,t=this,a=W.a.Title,n=this.state,i=n.videoOptions,r=n.title;return(null===(e=i.sources)||void 0===e?void 0:e.src)?o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"play-box"},o.a.createElement(N.a,{className:"site-page-header",onBack:function(){return t.props.history.goBack()},title:r}),o.a.createElement(q,i),o.a.createElement(R.a,null),o.a.createElement(a,{level:4,className:"title"},r))):o.a.createElement(o.a.Fragment,null,o.a.createElement(N.a,{className:"site-page-header",onBack:function(){return t.props.history.goBack()},title:r}),o.a.createElement(Y.a,null))}}]),a}(n.Component),H=Object(m.g)(G),K=function(e){Object(d.a)(a,e);var t=Object(u.a)(a);function a(){return Object(s.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){return o.a.createElement(l.b,null,o.a.createElement(m.d,null,o.a.createElement(m.b,{exact:!0,path:"/",component:_}),o.a.createElement(m.b,{path:"/Video",component:U}),o.a.createElement(m.b,{path:"/Play",component:H})))}}]),a}(n.Component);r.a.render(o.a.createElement(l.a,null,o.a.createElement(K,null)),document.getElementById("root"))}},[[230,1,2]]]);
//# sourceMappingURL=main.3a72e289.chunk.js.map