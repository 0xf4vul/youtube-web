(this["webpackJsonpreate-ts"]=this["webpackJsonpreate-ts"]||[]).push([[0],{143:function(e,t,a){},227:function(e,t,a){e.exports=a(411)},384:function(e,t){},411:function(e,t,a){"use strict";a.r(t);var n=a(0),o=a.n(n),l=a(18),i=a.n(l),r=(a(232),a(80)),c=a(62),s=a(63),d=a(68),u=a(67),p=a(39),m=(a(143),a(196)),h=a(417),f=a(422),g=a(56),v=a(79),_=a.n(v),y=a(195),k=a.n(y);function b(e,t){return new Promise((function(a,n){_.a.get(e,{params:t}).then((function(e){a(e.data)})).catch((function(e){n(e.data)}))}))}function E(e,t){return new Promise((function(a,n){_.a.post(e,k.a.stringify(t)).then((function(e){a(e.data)})).catch((function(e){n(e.data)}))}))}_.a.defaults.baseURL="/api",_.a.defaults.timeout=1e4,_.a.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded;charset=UTF-8",_.a.interceptors.request.use((function(e){return e}),(function(e){return Promise.reject(e)})),_.a.interceptors.response.use((function(e){return 200===e.status?Promise.resolve(e):Promise.reject(e)}),(function(e){if(e.response.status)return Promise.reject(e.response)}));var S,w=function(e){Object(d.a)(a,e);var t=Object(u.a)(a);function a(){var e;Object(c.a)(this,a);for(var n=arguments.length,o=new Array(n),l=0;l<n;l++)o[l]=arguments[l];return(e=t.call.apply(t,[this].concat(o))).state={token:""},e.onFinish=function(t){E("/token",{username:t.username}).then((function(t){if(t.status){var a=t.data.token;localStorage.setItem("token",a),localStorage.setItem("isManager",t.data.isManager),e.setState({token:a})}else m.a.error("\u9519\u8bef\u7684\u7528\u6237\u540d")})).catch((function(e){console.log(e)}))},e}return Object(s.a)(a,[{key:"componentDidMount",value:function(){var e=localStorage.getItem("token")||"";this.setState({token:e})}},{key:"render",value:function(){if(this.state.token)return o.a.createElement(p.a,{to:"/Video"});var e={wrapperCol:{offset:8,span:16}};return o.a.createElement("div",{className:"login-page"},o.a.createElement(h.a,Object.assign({},{labelCol:{span:8},wrapperCol:{span:16}},{name:"basic",initialValues:{remember:!0},onFinish:this.onFinish}),o.a.createElement(h.a.Item,{label:"\u60a8\u662f\uff1f",name:"username",rules:[{required:!0,message:"\u8f93\u5165\u767b\u5f55\u7528\u6237\u540d"}]},o.a.createElement(f.a,null)),o.a.createElement(h.a.Item,e,o.a.createElement(g.a,{type:"primary",htmlType:"submit"},"\u597d\u7684"))))}}]),a}(n.Component),O=a(157),C=a.n(O),j=a(202),I=a(415),N=a(160),P=a(424),T=a(420),x=a(421),M=a(97),V=a(60),D=a(416),L=a(423),A=a(418),B=a(425),F=a(426),J=a(427),U=a(428);!function(e){e.list="list",e.channel="channel"}(S||(S={}));var q=function(e){Object(d.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).state={token:"",left_drawer_visible:!1,list_type:S.list,channel_list:{list:[],channel:[]},videos:[],current_channel_id:"",page:{current:1,total:1,count:1},page_title:"",sort:1,channel_modal_visible:!1,add_channel_power:!1,add_channel_inpu_id:""},n.video_dom=[],n.getVideoList=function(){return b("/video_list",{token:localStorage.getItem("token")||""}).then((function(e){return e.status?e.data:[]}))},n.getVideos=function(e,t,a,o,l){var i=localStorage.getItem("token")||"",r=n.state,c=r.current_channel_id,s=r.page,d=r.sort,u=r.list_type;e&&(c=e);var p=s.current;t&&(p=t),void 0!==a&&null!==a&&(d=a),o&&(u=o);var m={token:i,id:c,page:p,sort:d,type:u};return l&&(m=Object.assign(m,{refresh:!0})),b("/videos",m).then((function(e){return e.status&&e.data.list.length?e.data:[]}))},n.showLeftDrawer=function(){n.setState({left_drawer_visible:!0})},n.hideLeftDrawer=function(){n.setState({left_drawer_visible:!1})},n.rootMenuKeys=["list","channel"],n.handleMenuOpenChange=function(e){var t=[n.state.list_type],a=[S.list,S.channel],o=e.find((function(e){return-1===t.indexOf(e)}));-1!==a.indexOf(o)&&n.setState({list_type:o||S.list})},n.handleMenuClick=function(e){var t=n.state.current_channel_id;if(e.key!==t){t=e.key;var a=e.item.props.data_title;n.getVideos(t,1,1).then((function(e){n.setState({left_drawer_visible:!1,videos:e.list,page:e.page,current_channel_id:t,page_title:a});var o=localStorage.getItem("video_id");if(o){var l=n.video_dom.findIndex((function(e){return e.id===o}));-1!==l?window.scrollTo(0,n.video_dom[l].srcoll-74):window.scrollTo(0,0)}n.storageScrollTop(),n.handleScroll("event")}))}},n.onPageChange=function(e){n.getVideos("",e).then((function(e){n.setState({videos:e.list,page:e.page}),n.storageScrollTop()}))},n.onSortChange=function(){var e=n.state.sort;e=1===e?0:1,n.getVideos("",1,e).then((function(t){n.setState({videos:t.list,page:t.page,sort:e}),n.storageScrollTop()}))},n.storageScrollTop=function(){var e=n.state,t=e.current_channel_id,a=e.page,o=e.sort,l=e.list_type;localStorage.setItem("page_info",JSON.stringify({id:t,page:a.current,sort:o,list_type:l}))},n.getPageStorage=function(){var e=localStorage.getItem("page_info")||"";return e?JSON.parse(e):{current_channel_id:"",current_page:1,sort:1,list_type:S.list}},n.storageVideoId=function(e){localStorage.setItem("video_id",e)},n.handleScroll=function(e){for(var t=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop,a=localStorage.getItem("video_id"),o=0;o<n.video_dom.length;o++)if(n.video_dom[o].srcoll>t){n.video_dom[o].id!=a&&n.storageVideoId(n.video_dom[o].id);break}},n.isPlay=function(e){var t=localStorage.getItem("played"),a=[];return t&&(a=JSON.parse(t)),-1!==a.indexOf(e)},n.logout=function(){localStorage.removeItem("token"),n.setState({token:""}),window.location.reload()},n.handlePlayClick=function(e,t,a){var o,l=localStorage.getItem("played");l?(o=JSON.parse(l)).push(e):o=[e],localStorage.setItem("played",JSON.stringify(o)),n.props.history.push({pathname:"/Play",state:{id:e,type:t,title:a}})},n.handleAddChange=function(){n.setState({channel_modal_visible:!0})},n.handleAddChannelOk=function(){var e=n.state.add_channel_inpu_id,t=localStorage.getItem("token")||"";if(34!=e.length&&24!=e.length)return m.a.error("\u9519\u8bef\u7684ID"),!1;E("/admin/channel_list",{id:e,token:t}).then((function(e){e.status?m.a.success("\u6dfb\u52a0\u6210\u529f"):m.a.warning(e.msg)})),n.setState({channel_modal_visible:!1})},n.handleAddChannelCancel=function(){n.setState({channel_modal_visible:!1})},n.listUpdate=function(){n.getVideos("",0,null,null,!0)},n}return Object(s.a)(a,[{key:"componentDidMount",value:function(){var e=Object(j.a)(C.a.mark((function e(){var t,a,n,o=this;return C.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(window.addEventListener("scroll",this.handleScroll),t=localStorage.getItem("token")||"",a=localStorage.getItem("isManager")||"0",n="1"==a,!t){e.next=7;break}return e.next=7,this.getVideoList().then((function(e){var t=e,a=o.getPageStorage(),l=a.current_channel_id,i=a.current_page,r=a.sort,c=a.list_type,s="";if(console.log(c,t),!l&&t[c].length)l=t[c][0].id,s=t[c][0].title;else if(t[c].length){var d=t[c].find((function(e){return e.id===l}));d&&d.title&&(s=d.title)}console.log("call getVideos"),o.getVideos(l,i,r,c).then((function(e){console.log(e),o.setState({channel_list:t,videos:e.list,page:e.page,current_channel_id:l,page_title:s,add_channel_power:n,list_type:c});var a=localStorage.getItem("video_id");if(a){var i=o.video_dom.findIndex((function(e){return e.id===a}));-1!==i&&window.scrollTo(0,o.video_dom[i].srcoll-74)}o.storageScrollTop(),o.handleScroll("event")}))}));case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"componentDidUpdate",value:function(){for(var e=document.getElementsByClassName("video_card"),t=[],a=0;a<e.length;a++)t.push({id:e[a].id,srcoll:this.getOffsetTop(e[a])});this.video_dom=t,window.scrollTo(0,0)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("scroll",this.handleScroll)}},{key:"getOffsetTop",value:function(e){for(var t=0;e!=window.document.body&&null!=e;)t+=e.offsetTop,e=e.offsetParent;return t}},{key:"render",value:function(){var e=this,t=localStorage.getItem("token")||"",a=this.state,n=a.videos,l=a.left_drawer_visible,i=a.channel_list,r=a.page_title,c=a.sort,s=a.add_channel_power,d=a.current_channel_id;console.log(s);var u=I.a.Meta,m=N.a.SubMenu;if(!t)return o.a.createElement(p.a,{to:"/"});var h=[o.a.createElement(g.a,{onClick:this.logout,key:"logout_button"},"\u9000\u51fa"),o.a.createElement(g.a,{onClick:this.onSortChange,key:"sort_button"},c?"\u6700\u65b0":"\u6700\u65e9"),o.a.createElement(g.a,{type:"primary",shape:"circle",icon:o.a.createElement(B.a,null),onClick:this.listUpdate,key:"update_button"})];return s&&h.push(o.a.createElement(g.a,{shape:"circle",onClick:this.handleAddChange,key:"addChange_button"},"+")),o.a.createElement(o.a.Fragment,null,o.a.createElement(P.a,{offsetTop:0},o.a.createElement(T.a,{className:"site-page-header",onBack:this.showLeftDrawer,title:r,subTitle:"",ghost:!1,backIcon:o.a.createElement(F.a,null),extra:h})),o.a.createElement(x.a,{title:"\u64ad\u653e\u5217\u8868",placement:"left",closable:!1,onClose:this.hideLeftDrawer,visible:l},o.a.createElement(N.a,{mode:"inline",openKeys:[this.state.list_type],onOpenChange:this.handleMenuOpenChange,style:{width:256},onClick:this.handleMenuClick},o.a.createElement(m,{key:"list",title:o.a.createElement("span",null,o.a.createElement(J.a,null),o.a.createElement("span",null,"\u89c6\u9891\u5217\u8868"))},i.list.map((function(e,t){return o.a.createElement(N.a.Item,{key:e.id,className:d===e.id?"ant-menu-item-selected":"","data-title":e.title},e.title)}))),o.a.createElement(m,{key:"channel",title:o.a.createElement("span",null,o.a.createElement(U.a,null),o.a.createElement("span",null,"\u9891\u9053\u5217\u8868"))},i.channel.map((function(e,t){return o.a.createElement(N.a.Item,{key:e.id,className:d===e.id?"ant-menu-item-selected":"","data-title":e.title},e.title)}))))),o.a.createElement(M.a,{className:"card_list",gutter:{md:16,xl:32}},n.map((function(t,a){return o.a.createElement(V.a,{sm:32,md:16,xl:8,className:"video_card card_margin_bottom",id:"video_"+t.id,key:a},o.a.createElement(I.a,{style:{width:"100%"},cover:o.a.createElement("img",{alt:"example",src:t.thumbnail}),actions:[o.a.createElement(g.a,{onClick:function(){e.handlePlayClick(t.id,"video",t.title)},type:e.isPlay(t.id)?"dashed":"primary"},"\u89c6\u9891"),o.a.createElement(g.a,{onClick:function(){e.handlePlayClick(t.id,"audio",t.title)},type:e.isPlay(t.id)?"dashed":"default"},"\u97f3\u9891")]},o.a.createElement(u,{title:t.title,description:t.created_at})))}))),o.a.createElement(D.a,{current:this.state.page.current,onChange:this.onPageChange,defaultPageSize:50,total:this.state.page.total,showSizeChanger:!1}),o.a.createElement(L.a,null),o.a.createElement(A.a,{title:"\u6dfb\u52a0\u9891\u9053",visible:this.state.channel_modal_visible,onOk:this.handleAddChannelOk,onCancel:this.handleAddChannelCancel},o.a.createElement(f.a,{placeholder:"\u8f93\u5165\u5217\u8868ID",onChange:function(t){e.setState({add_channel_inpu_id:t.target.value})}})))}}]),a}(n.Component),z=Object(p.g)(q),K=a(223),W=(a(400),function(e){Object(d.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).player=void 0,n.videoNode=void 0,n.player=void 0,n.videoNode=void 0,n}return Object(s.a)(a,[{key:"componentDidMount",value:function(){this.player=Object(K.a)(this.videoNode,this.props).ready((function(){}))}},{key:"componentWillUnmount",value:function(){this.player&&this.player.dispose()}},{key:"render",value:function(){var e=this;return n.createElement("div",{className:"c-player"},n.createElement("div",{className:"c-player__screen","data-vjs-player":"true"},n.createElement("video",{ref:function(t){return e.videoNode=t},className:"video-js vjs-16-9"})))}}]),a}(n.Component)),R=a(419),Y=a(413),G=a(414),H=function(e){Object(d.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).state={token:"",id:"",type:"",title:"",videoOptions:{}},n.player=void 0,n}return Object(s.a)(a,[{key:"componentDidMount",value:function(){var e,t=localStorage.getItem("token")||"";if(null===(e=this.props.location.state)||void 0===e?void 0:e.id){var a=this.props.location.state,n=a.id,o=a.type,l=a.title,i="video/mp4";"audio"==o&&(i="audio/mp4"),this.setState({token:t,id:n,type:o,title:l,videoOptions:{autoplay:!0,controls:!0,sources:{src:"/api/play?id=".concat(n,"&type=").concat(o,"&token=").concat(t),type:i}}})}else this.props.history.push("/")}},{key:"render",value:function(){var e,t=this,a=R.a.Title,n=this.state,l=n.videoOptions,i=n.title;return(null===(e=l.sources)||void 0===e?void 0:e.src)?o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"play-box"},o.a.createElement(T.a,{className:"site-page-header",onBack:function(){return t.props.history.goBack()},title:i}),o.a.createElement(W,l),o.a.createElement(Y.a,null),o.a.createElement(a,{level:4,className:"title"},i))):o.a.createElement(o.a.Fragment,null,o.a.createElement(T.a,{className:"site-page-header",onBack:function(){return t.props.history.goBack()},title:i}),o.a.createElement(G.a,null))}}]),a}(n.Component),Q=Object(p.g)(H),X=function(e){Object(d.a)(a,e);var t=Object(u.a)(a);function a(){return Object(c.a)(this,a),t.apply(this,arguments)}return Object(s.a)(a,[{key:"render",value:function(){return o.a.createElement(r.b,null,o.a.createElement(p.d,null,o.a.createElement(p.b,{exact:!0,path:"/",component:w}),o.a.createElement(p.b,{path:"/Video",component:z}),o.a.createElement(p.b,{path:"/Play",component:Q})))}}]),a}(n.Component);i.a.render(o.a.createElement(r.a,null,o.a.createElement(X,null)),document.getElementById("root"))}},[[227,1,2]]]);
//# sourceMappingURL=main.cb0cde37.chunk.js.map